<Window x:Class="ProSchedules.UI.SortingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:ui="clr-namespace:ProSchedules.UI"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d" 
        Title="Sorting" Height="600" Width="600"
        MinWidth="600" MinHeight="400"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        ResizeMode="CanResize"
        WindowStartupLocation="CenterOwner">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <SolidColorBrush x:Key="PrimaryBackgroundBrush" Color="#FF1F1F1F" />
                    <SolidColorBrush x:Key="SecondaryBackgroundBrush" Color="#FF292929" />
                    <SolidColorBrush x:Key="BorderBrush" Color="#FF444444" />
                    <SolidColorBrush x:Key="ForegroundBrush" Color="#EEEEEE" />
                </ResourceDictionary>
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.ComboBox.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Dark.xaml" />
                <ResourceDictionary Source="pack://application:,,,/ProSchedules;component/UI/Themes/ElementStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
            <ui:InverseBooleanConverter x:Key="InverseBooleanConverter"/>

            <Style x:Key="CancelButtonStyle" BasedOn="{StaticResource NegativeActionButtonStyle}" TargetType="Button">
                <Setter Property="Background" Value="#FF555555"/>
                <Setter Property="BorderBrush" Value="#FF555555"/>
                <Setter Property="Foreground" Value="White"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="#1E1E1E" 
            BorderBrush="#333333" 
            BorderThickness="1" 
            CornerRadius="8">
        <Grid Margin="0">
             <Grid.RowDefinitions>
                 <RowDefinition Height="Auto"/> <!-- TitleBar -->
                 <RowDefinition Height="Auto"/> <!-- Header Actions -->
                 <RowDefinition Height="*"/>    <!-- Content -->
                 <RowDefinition Height="Auto"/> <!-- Footer -->
             </Grid.RowDefinitions>
             
             <!-- Title Bar -->
             <ui:TitleBar Grid.Row="0" Foreground="{DynamicResource ForegroundBrush}" IsMinimizeVisible="False" />

             <!-- Header Actions -->
             <Grid Grid.Row="1" Margin="20,10,20,10">
                 <TextBlock Text="Sorting Rules" FontSize="18" FontWeight="SemiBold" Foreground="White" VerticalAlignment="Center"/>
                 <Button HorizontalAlignment="Right" 
                         Click="AddSortLevel_Click"
                         Width="32" Height="32"
                         Style="{StaticResource FlatIconButton}"
                         ToolTip="Add Sort Level">
                      <materialDesign:PackIcon Kind="Plus" Width="24" Height="24" Foreground="White"/>
                 </Button>
             </Grid>
             
             <!-- Content ItemControl -->
             <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="20,0,20,20">
                 <ItemsControl ItemsSource="{Binding SortCriteria}">
                     <ItemsControl.ItemTemplate>
                         <DataTemplate>
                             <Border Background="#252525" BorderBrush="#333333" BorderThickness="1" CornerRadius="4" Margin="0,0,0,10" Padding="10">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="80"/>
                                         <ColumnDefinition Width="200"/>
                                         <ColumnDefinition Width="Auto"/>
                                         <ColumnDefinition Width="Auto"/>
                                         <ColumnDefinition Width="*"/>
                                         <ColumnDefinition Width="Auto"/>
                                     </Grid.ColumnDefinitions>
                                     <Grid.RowDefinitions>
                                         <RowDefinition Height="Auto"/>
                                         <RowDefinition Height="Auto"/>
                                     </Grid.RowDefinitions>
                                     
                                     <!-- Row 1: Sort By dropdown + Direction -->
                                     <TextBlock Text="Sort by:" Foreground="Gray" VerticalAlignment="Center" Grid.Column="0"/>
                                     
                                     <!-- Note: AvailableSortColumns is in DataContext (SortingWindow) -->
                                     <ComboBox Grid.Column="1" 
                                               ItemsSource="{Binding DataContext.AvailableSortColumns, RelativeSource={RelativeSource AncestorType=Window}}"
                                               SelectedItem="{Binding SelectedColumn}"
                                               Style="{StaticResource DarkComboBoxStyle}"
                                               Margin="0,0,10,0"/>
                                               
                                     <RadioButton Grid.Column="2" GroupName="{Binding GetHashCode}" Content="Ascending" 
                                                  IsChecked="{Binding IsAscending}" Foreground="White" Margin="0,0,10,0"/>
                                     <RadioButton Grid.Column="3" GroupName="{Binding GetHashCode}" Content="Descending" 
                                                  IsChecked="{Binding IsAscending, Converter={StaticResource InverseBooleanConverter}}" Foreground="White"/>
                                                  
                                     <!-- Delete Button -->
                                     <Button Grid.Column="5" Click="RemoveSortItem_Click" Style="{StaticResource FlatIconButton}" Width="24" Height="24">
                                         <materialDesign:PackIcon Kind="Close" Width="16" Height="16" Foreground="Gray"/>
                                     </Button>
                                     
                                     <!-- Row 2: Checkboxes (Visual placeholders) -->
                                     <StackPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" Orientation="Horizontal" Margin="0,10,0,0">
                                         <CheckBox Content="Header" IsChecked="{Binding ShowHeader}" Style="{StaticResource DarkCheckBoxStyle}" Foreground="White" Margin="0,0,20,0"/>
                                         <CheckBox Content="Footer" IsChecked="{Binding ShowFooter}" Style="{StaticResource DarkCheckBoxStyle}" Foreground="White" Margin="0,0,20,0"/>
                                         <CheckBox Content="Blank line" IsChecked="{Binding ShowBlankLine}" Style="{StaticResource DarkCheckBoxStyle}" Foreground="White"/>
                                     </StackPanel>
                                 </Grid>
                             </Border>
                         </DataTemplate>
                     </ItemsControl.ItemTemplate>
                 </ItemsControl>
             </ScrollViewer>
             
             <!-- Footer -->
             <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
                 <Button Content="Apply" Click="SortApply_Click" 
                         Style="{StaticResource CustomActionButtonStyle}" 
                         Width="120" Height="35" FontSize="12" Margin="5,0,5,0"/>
                 <Button Content="Cancel" Click="SortCancel_Click" 
                         Style="{StaticResource CancelButtonStyle}" 
                         Width="120" Height="35" FontSize="12" Margin="5,0,5,0"/>
             </StackPanel>
        </Grid>
    </Border>
</Window>
